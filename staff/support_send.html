<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="/client_management.js" type="module"></script>
	<title>support_send | vulbyte</title>
</head>

<body>
	<h1>support send</h1>
	<style>
		form>* {
			display: block;
			margin: auto;
			margin-bottom: 0.5em;
			width: 80%;
		}
	</style>
	<form id="input">
		<div>
			<label>un:</label>
			<input id="un" type="text">
		</div>
		<div>
			<label>pw:</label>
			<input id="pw" type="password">
			<button type="button" onclick="(() => {document.getElementById('pw').type='text'})()"
				onmouseleave="(()=>{document.getElementById('pw').type='password'})()">show</button>
		</div>
		<div>
			<label>frm:</label>
			<input id="frm" type="email">
		</div>
		<div>
			<label>to:</label>
			<input id="to" type="text" placeholder="subject">
		</div>
		<div>
			<label>subject:</label>
			<input id="subject" type="text" placeholder="subject">
		</div>
		<div>
			<label>message:</label>
			<textarea id="body" type="text" placeholder="message body"></textarea>
		</div>
	</form>
	<br>)
	<p><em>double check before hitting send!</em></p>
	<div style="width:100%; margin:auto; display:flex; ">
		<button style="margin:auto; padding:0.5em;" type="submit">send email</button>
	</div>

	<br>
	<br>
	<br>

	<div>
		<label>email status:</label>
		<output id="status" style="width:30rem; margin:auto;">nothing to display... yet...</output>
	</div>
</body>

<script>
	document.querySelector("button[type=submit]").addEventListener("click", async () => {
		try {
			let inputs = document.getElementsByTagName("input");

			let data = {};
			let id, value;

			for (let i = 0; i < inputs.length; ++i) {
				id = inputs[i].id;
				if (id == 'from') {id = 'frm'}
				value = inputs[i].value;

				data[id] = value;
			}

			console.log(data);

			const res = await fetch("https://mxlnbnqnwyotgobsuaet.supabase.co/functions/v1/secure_connection_test", {
				method: "POST",
				headers: {"Content-Type": "application/json"},
				body: JSON.stringify(data),
			});

			const result = await res.json();
			const status = document.getElementById('status');
			if (result.ok) {
				status.innerText = "email sent!";
			} else {
				status.innerText = String("Error: " + result.error);
			}
		}
		catch (err) {
			const status = document.getElementById('status');
			status.innerText = String("Error: " + err);
		}
	})
</script>


</html>
