<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="/client_management.js" type="module"></script>
	<title>support_send | vulbyte</title>
</head>

<body>
	<h1>support send</h1>
	<style>
		form>* {
			display: block;
			margin: auto;
			margin-bottom: 0.5em;
			width: 80%;
		}
	</style>
	<form id="input">
		<div>
			<label>un:</label>
			<input id="un" type="text">
		</div>
		<div>
			<label>pw:</label>
			<input id="pw" type="password">
			<button type="button" onclick="(() => {document.getElementById('pw').type='text'})()"
				onmouseleave="(()=>{document.getElementById('pw').type='password'})()">show</button>
		</div>
		<div>
			<label>frm:</label>
			<input id="frm" type="email">
		</div>
		<div>
			<label>to:</label>
			<input id="to" type="text" placeholder="subject">
		</div>
		<div>
			<label>subject:</label>
			<input id="subject" type="text" placeholder="subject">
		</div>
		<div>
			<label>message:</label>
			<textarea id="message" type="text" placeholder="message body"></textarea>
		</div>
	</form>
	<br>)
	<p><em>double check before hitting send!</em></p>
	<div style="width:100%; margin:auto; display:flex; ">
		<button style="margin:auto; padding:0.5em;" type="submit">send email</button>
	</div>

	<br>
	<br>
	<br>

	<div>
		<label>email status:</label>
		<output id="status" style="width:30rem; margin:auto;">nothing to display... yet...</output>
	</div>
</body>

<script type="module">
	import Authenticate from "/lib/authenticate.mjs";
	const auth = new Authenticate();
	import Communication from "/lib/communication.mjs";
	const comm = new Communication();

	// Example: send secure email request
	document.querySelector("button[type=submit]").addEventListener("click", async () => {
		let inputs = document.getElementsByTagName("input");
		let data = {};
		for (let i = 0; i < inputs.length; ++i) {
			data[inputs[i].id] = inputs[i].value
		}
		//custom for textarea
		data["message"] = document.getElementById("message").value;

		try {
			const result = await comm.send({
				body: {
					un: data["un"],
					pw: data["pw"],
					frm: data["frm"],
					to: data["to"],
					subject: data["subject"],
					message: data["message"]
				}
			});
			console.log("Server result:", result);
			document.getElementById("status").innerText = "Sent!";
		} catch (err) {
			console.error("Communication error:", err);
			document.getElementById("status").innerText = "Error: " + err.message;
		}
	});
</script>


</html>
