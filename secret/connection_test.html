<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>RSA JWT Generator</title>
	<style>
		body {
			font-family: sans-serif;
			max-width: 600px;
			margin: 2rem auto;
		}

		textarea,
		input {
			width: 100%;
			padding: 8px;
			margin: 6px 0;
			font-family: monospace;
		}

		button {
			margin: 4px 4px 12px 0;
			padding: 8px 12px;
		}

		.box {
			border: 1px solid #ccc;
			padding: 1rem;
			margin: 1rem 0;
			border-radius: 6px;
		}
	</style>
	<script src="/client_management.js" type="module"></script>
</head>

<body>
	<h1>RSA JWE/JWT Generator</h1>

	<div class="box">
		<h3>Step 1: Generate Keys</h3>
		<button id="generateKeys">Generate RSA Keys</button>
		<br>
		<textarea id="publicKey" rows="5" readonly placeholder="Public JWK will appear here"></textarea>
		<button id="copyPublic">Copy Public</button>
		<br>
		<textarea id="privateKey" rows="5" readonly placeholder="Private JWK will appear here"></textarea>
		<button id="copyPrivate">Copy Private</button>
	</div>

	<div class="box">
		<h3>Step 2: Create JWT with custom payload</h3>
		<label>Payload (JSON):</label>
		<textarea id="payload" rows="6">{ "sub": "123", "name": "Alice", "iat": 1700000000 }</textarea>
		<br>
		<button id="createJwt">Create JWT</button>
		<textarea id="jwt" rows="5" readonly placeholder="Generated JWT will appear here"></textarea>
	</div>

	<script type="module">
		import RSAJWE from "/lib/jwt.js"; // adjust path to your RSAJWE class file

		let pubJwk = null;
		let privJwk = null;

		const pubEl = document.getElementById("publicKey");
		const privEl = document.getElementById("privateKey");
		const jwtEl = document.getElementById("jwt");

		document.getElementById("generateKeys").onclick = async () => {
			const {publicKey, privateKey} = await RSAJWE.generateKeys();
			pubJwk = publicKey;
			privJwk = privateKey;
			pubEl.value = JSON.stringify(publicKey, null, 2);
			privEl.value = JSON.stringify(privateKey, null, 2);
		};

		document.getElementById("createJwt").onclick = async () => {
			if (!pubJwk) {alert("Generate keys first!"); return;}
			try {
				const payload = JSON.parse(document.getElementById("payload").value);
				const token = await RSAJWE.encode(payload, pubJwk);
				jwtEl.value = token;
			} catch (err) {
				alert("Invalid payload JSON: " + err.message);
			}
		};

		document.getElementById("copyPublic").onclick = async () => {
			if (!pubEl.value) return;
			await navigator.clipboard.writeText(pubEl.value);
			alert("Public key copied!");
		};

		document.getElementById("copyPrivate").onclick = async () => {
			if (!privEl.value) return;
			await navigator.clipboard.writeText(privEl.value);
			alert("Private key copied!");
		};
	</script>
</body>

</html>
