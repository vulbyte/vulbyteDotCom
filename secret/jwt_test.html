<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="/client_management.js" type='module'></script>
	<title>JWT_Test | vulbyte</title>
</head>

<body>
	<br>
	<br>
	<br>
	<h1 class="marquee">JWT testing</h1>
	<hr>
	<div>
		<h2 class="marquee">encode</h2>
		<label>phrase</label>
		<input type='text' id='input_a'>
		<label>secret</label>
		<input type='text' id='input_b'>
		<br>
		<button id='test_encode'>XOR test</button>
	</div>
	<div>
		<label>encoded string</label>
		<input type="text" id='xor_out'>
	</div>
	<hr>
	<div>
		<h2 class='marquee'>decode</h2>
		<button id='test_decode'>decode string</button>
	</div>
	<div>
		<input type="text" id="decode_out">
	</div>



	<script type='module'>
		//{{{1 DELETE THESE LATER (for itesting)
		const te = new TextEnconder('utf-8');
		document.getElementById('test_encode').addEventListener('click', (e) => {
			document.getElementById("xor_out").value = (
				XOR2Strings(
					document.getElementById('input_a').value,
					document.getElementById('input_b').value
				)
			);
		});

		document.getElementById('test_decode').addEventListener('click', (e) => {
			document.getElementById("decode_out").value = (
				XOR2Strings(
					document.getElementById('xor_out').value,
					document.getElementById('input_b').value
				)
			);
		});
		//}}}1
		function toBinaryRepr(str) {
			return (Array.from(
				te.encode(str)).map(i => i.toString(2).padStart(8, '0').join(' '))
			)
		}
		function XOR2Strings(a, b) {
			if (a == undefined || b == undefined) {
				console.log('a or b is undefined, both NEED to be defined');
				return 1;
			}

			console.log('a proper: ', toBinaryRepr(a));
			console.log('a proper: ', toBinaryRepr(a));

			let encoded = [];

			//console.log(`phrase as bin is: ${}`)

			for (let i = 0; i < a.length; ++i) {
				let char_a = a[i % a.length];
				let char_b = b[i % b.length];

				console.log('xoring: ' + char_a + ', ' + char_b);
				encoded += (XorChar(char_a, char_b));
			}

			console.warn('xor complete');;

			return (encoded);
		}

		function XorChar(a, b) {
		}

		function XorASCIIChar(a, b) {
			//{{{2 checks
			if (a == undefined || b == undefined) {
				console.error('a or b is undefined, both NEED to be defined');
				return 1;
			}

			if (a.length != 1) {
				console.error('a is not a character!');
				return 2;
			}
			if (b.length != 1) {
				console.error('b is not a character!');
				return 2;
			}
			a = String(a);
			b = String(b);
			//}}}2 checks
			console.log(`xoring 2 chars: ${a}, ${b}`);
			let ret = NumToChar(
				B64ToCharCode(UTF8ToB64(a))
				^ B64ToCharCode(UTF8ToB64(b))
			);
			console.log('xor of ab is: ' + ret);
			return (ret);
		} ar

		function NumToChar(num) {
			return (String.fromCharCode(num));
		}

		function B64ToUTF8(code) {
			//{{{2 checks
			if (code == undefined) {
				console.error('a or b is undefined, both NEED to be defined');
				return 1;
			}
			console.log(`b64ToUTF8ing: ${code}`);
			//}}}2 checks
			return (String(code).charCodeAt(0));
		}

		function B64ToCharCode(code) {
			return (String(code).charCodeAt(0));
		}

		function UTF8ToB64(char) {
			try {
				//{{{2 checks
				if (char == undefined) {
					console.error('code is undefined, both NEED to be defined');
					return 1;
				}

				if (char.length != 1) {
					console.error(`${code} is not a character!`);
					return 2;
				}
				//}}}2 checks
				return (btoa(char));
			}
			catch (err) {
				console.error(char, err);
			}
		}

		/*
		function ToBase64AndXOR(a, b) {
			if (a == undefined || b == undefined) {
				console.log('a or b is undefined, both NEED to be defined');
				return 1
			}

		console.log('ab after atob: ', a, b);
		let str = [];

		for (let i = 0; i < a.length; ++i) {
			let new_a = a[i].charCodeAt(0);
			let new_b = b[a.length % i].charCodeAt(0);
			let res = String.fromCharCode(new_a ^ new_b);
			console.log(
				'new ab: ' + new_a + ' ' + new_b +
				"\n xor'd: " + res
			);

			str += res;
		}
		console.log('encoded string: ' + str);
		return (str);
		}
		*/
	</script>

</body>

</html>
