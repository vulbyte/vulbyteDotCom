<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="module" src='/client_management.js'></script>
	<title>Write Data Example</title>
</head>

<body>
	<div>
		<h1>sign in</h1>
		<aside>please note: there is no account creation at the moment, as vulbyte is currently making sure the connection
			is secure before allowing the site to be public :3</aside>
	</div>
	<div>
		<div><label for="username">username</label><input id="username" type="text"></div>
		<div><label for="password">password</label><input id="password" type="password"></div>
		<div><button id="submit">submit</button></div>
		<script type='module'>
			// ====================== client_management.js ======================
			import Networking from "/lib/networking.mjs"; // adjust path if needed

			function LSGI(id) {
				try {
					return localStorage.getItem(id)
				}
				catch (err) {
					throw new Error(err);
				}
			}
			// helper shortcuts
			function GEBI(id) {
				return document.getElementById(id);
			}

			// create an instance (stateless until you call methods)
			const net = new Networking();

			window.addEventListener("DOMContentLoaded", () => {
				const usernameInput = GEBI("username");
				const passwordInput = GEBI("password");
				const submitInput = GEBI("submit");

				// optionally add a submit button dynamically or handle Enter key
				passwordInput.addEventListener("keydown", async (e) => {
					if (e.key === "Enter") {
						await attemptSignIn();
					}
				});
				submitInput.addEventListener("click", async (e) => {
					await attemptSignIn();
				});

				async function attemptSignIn() {
					const username = usernameInput.value.trim();
					const password = passwordInput.value.trim();

					if (!username || !password) {
						alert("Please fill in both username and password");
						return;
					}

					try {
						console.log("Attempting to sign in...");
						const result = await net.SignIn(username, password);

						console.log("Server response:", result);

						if (result?.jwt || result?.serverJWT) {
							alert("Signed in successfully!");
						} else {
							alert("Sign-in failed or requires 2FA.");
						}
					} catch (err) {
						console.error("Sign-in error:", err);
						alert("Error signing in: " + err.message);
					}
				}
			});

		</script>
	</div>
</body>

</html>
